<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­åŒ»ä½“è´¨æµ‹è¯„ç³»ç»Ÿ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    
    <style>
      * { box-sizing: border-box; }
      :root { --primary: #8B4513; --primary-light: #A0522D; --primary-dark: #654321; --secondary: #E8D0B3; --accent: #D2691E; --light: #f9f5f0; --dark: #333333; --success: #4CAF50; --warning: #FF9800; --danger: #f44336; --gray: #e0e0e0; --shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
      .ds-container { max-width: 1000px; margin: 0 auto; background: #fff; border-radius: 20px; box-shadow: var(--shadow); overflow: hidden; position: relative; }
      .ds-container::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 5px; background: linear-gradient(to right, var(--primary), var(--accent)); }
      .ds-header { background: linear-gradient(to right, var(--primary), var(--primary-light)); color: #fff; padding: 30px; text-align: center; position: relative; overflow: hidden; }
      .ds-logo { font-size: 24px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; }
      .ds-progress-wrap { background-color: var(--light); padding: 20px 30px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--gray); }
      .ds-progress-bar { height: 10px; background-color: var(--gray); border-radius: 5px; flex-grow: 1; margin: 0 20px; overflow: hidden; }
      .ds-progress { height: 100%; background: linear-gradient(to right, var(--primary), var(--accent)); width: 0%; transition: width 0.5s ease; }
      .ds-content { padding: 30px; }
      .ds-intro { text-align: center; margin-bottom: 30px; padding: 30px; background-color: var(--light); border-radius: 15px; border-left: 5px solid var(--primary); box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
      .ds-gender { margin: 25px 0; padding: 20px; background: #fff; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: 1px solid var(--gray); }
      .ds-buttons { display: flex; justify-content: space-between; margin-top: 30px; }
      .ds-btn { padding: 14px 28px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px; font-weight: 500; }
      .ds-btn-primary { background: var(--primary); color: #fff; box-shadow: 0 4px 8px rgba(139, 69, 19, 0.3); }
      .ds-btn-secondary { background: var(--light); color: var(--dark); border: 1px solid var(--gray); }
      .ds-result { display: none; margin-top: 20px; }
      .question-section { display: none; }
      .question-section.active { display: block; }
      @media (max-width: 768px) { .ds-content { padding: 20px; } }
    </style>
</head>
<body>
    <nav class="navbar">
      <div class="logo"><i class="fas fa-leaf"></i> AIæº¯æºæ™ºå…»</div>
      <ul class="nav-links">
        <li><a href="index.html" class="nav-link">é¦–é¡µ</a></li>
        <li><a href="assessment-quiz.html" class="nav-link">AIä½“è´¨æµ‹è¯„</a></li>
        <li><a href="recommend.html" class="nav-link">æ™ºèƒ½æ»‹è¡¥æ¨è</a></li>
        <li><a href="advisor.html" class="nav-link">AIå¥åº·é¡¾é—®</a></li>
        <li><a href="account.html" class="nav-link">ç”¨æˆ·ä¸­å¿ƒ</a></li>
      </ul>
      <div class="auth-buttons">
        <button class="btn-login" onclick="window.location.href='account.html'">ç™»å½•</button>
        <button class="btn-register" onclick="window.location.href='account.html'">æ³¨å†Œ</button>
        <button id="themeToggle" class="theme-toggle" aria-label="åˆ‡æ¢ä¸»é¢˜" aria-pressed="false">ğŸŒ™ æ·±è‰²</button>
      </div>
    </nav>
    <main style="padding:20px 0;">
      <div class="ds-container">
        <header class="ds-header">
          <div class="ds-logo"><i class="fas fa-leaf"></i><span>ä¸­åŒ»ä½“è´¨æµ‹è¯„</span></div>
          <h1>ä¸­åŒ»ä½“è´¨æµ‹è¯„ç³»ç»Ÿ</h1>
          <p>æ ¹æ®ã€Šä¸­åŒ»ä½“è´¨åˆ†ç±»ä¸åˆ¤å®šã€‹æ ‡å‡†ï¼Œå¸®åŠ©æ‚¨äº†è§£è‡ªèº«ä½“è´¨ç±»å‹ï¼Œæä¾›ä¸ªæ€§åŒ–å…»ç”Ÿå»ºè®®</p>
        </header>
        <div class="ds-progress-wrap">
          <span id="progress-text">è¿›åº¦: 0%</span>
          <div class="ds-progress-bar"><div class="ds-progress" id="progress"></div></div>
          <span id="section-indicator">0/9</span>
        </div>
        <div class="ds-content">
          <div class="ds-intro active" id="intro-section">
            <h2><i class="fas fa-heartbeat"></i> æ¬¢è¿ä½¿ç”¨ä¸­åŒ»ä½“è´¨æµ‹è¯„</h2>
            <p>æœ¬æµ‹è¯„åŸºäºä¸­åä¸­åŒ»è¯å­¦ä¼šå‘å¸ƒçš„ã€Šä¸­åŒ»ä½“è´¨åˆ†ç±»ä¸åˆ¤å®šã€‹æ ‡å‡†(ZYYXH/T157-2009)ï¼Œé€šè¿‡ç§‘å­¦çš„æ–¹æ³•å¸®åŠ©æ‚¨äº†è§£è‡ªèº«ä½“è´¨ç±»å‹ã€‚</p>
            <p>è¯·æ ¹æ®æ‚¨è¿‘ä¸€å¹´çš„ä½“éªŒå’Œæ„Ÿè§‰å›ç­”é—®é¢˜ï¼Œé€‰æ‹©æœ€ç¬¦åˆæ‚¨å®é™…æƒ…å†µçš„é€‰é¡¹ã€‚</p>
            <div class="ds-gender">
              <h3><i class="fas fa-venus-mars"></i> è¯·é€‰æ‹©æ‚¨çš„æ€§åˆ«</h3>
              <div style="display:flex; gap:20px; justify-content:center;">
                <label><input type="radio" name="gender" value="male" checked> ç”·æ€§</label>
                <label><input type="radio" name="gender" value="female"> å¥³æ€§</label>
              </div>
            </div>
            <button id="start-btn" class="ds-btn ds-btn-primary"><i class="fas fa-play-circle"></i> å¼€å§‹æµ‹è¯„</button>
          </div>
          <form id="constitution-test"></form>
          <div class="ds-buttons">
            <button id="prev-btn" class="ds-btn ds-btn-secondary" style="display:none;"><i class="fas fa-arrow-left"></i> ä¸Šä¸€éƒ¨åˆ†</button>
            <button id="next-btn" class="ds-btn ds-btn-primary" style="display:none;">ä¸‹ä¸€éƒ¨åˆ† <i class="fas fa-arrow-right"></i></button>
            <button id="submit-btn" class="ds-btn ds-btn-primary" style="display:none;"><i class="fas fa-paper-plane"></i> æäº¤æµ‹è¯„</button>
          </div>
          <div class="ds-result" id="result-section">
            <div class="result-header">
              <h2><i class="fas fa-chart-line"></i> æ‚¨çš„ä½“è´¨æµ‹è¯„ç»“æœ</h2>
              <p>ä»¥ä¸‹æ˜¯æ ¹æ®æ‚¨çš„å›ç­”å¾—å‡ºçš„ä½“è´¨ç±»å‹åˆ†æï¼Œè¯·å‚è€ƒç›¸å…³å»ºè®®æ”¹å–„å¥åº·çŠ¶å†µ</p>
            </div>
            <div id="result-content"></div>
            <button class="ds-btn ds-btn-primary" id="restart-btn"><i class="fas fa-redo"></i> é‡æ–°æµ‹è¯„</button>
          </div>
        </div>
      </div>
    </main>
    
    <script>
      // Updated questions and logic based on user request
      const constitutionTypes = {
        'A': { name: 'æ°”è™šè´¨', desc: 'å…ƒæ°”ä¸è¶³ï¼Œä»¥ç–²ä¹ã€æ°”çŸ­ã€è‡ªæ±—ç­‰æ°”è™šè¡¨ç°ä¸ºä¸»è¦ç‰¹å¾', icon: 'fas fa-wind', questions: ["æ‚¨è¯´è¯å£°éŸ³ä½å¼±æ— åŠ›å—ï¼Ÿï¼ˆæ¯”åˆ«äººè¯´è¯å£°éŸ³å°ï¼‰","æ‚¨å®¹æ˜“æ„Ÿåˆ°ç–²ä¹æ— åŠ›å—ï¼Ÿ","æ‚¨å®¹æ˜“æ°”çŸ­ï¼ˆå‘¼å¸çŸ­ä¿ƒï¼Œæ¥ä¸ä¸Šæ°”ï¼‰å—ï¼Ÿï¼ˆæ´»åŠ¨æ—¶æˆ–ä¸æ´»åŠ¨æ—¶ï¼‰","æ‚¨å–œæ¬¢å®‰é™ï¼Œæ‡’äºæ´»åŠ¨å—ï¼Ÿ","æ‚¨æ´»åŠ¨é‡ç¨å¤§å°±å®¹æ˜“å‡ºè™šæ±—å—ï¼Ÿ","æ‚¨èˆŒå¤´è¾¹ç¼˜æœ‰é½¿ç—•å—ï¼Ÿ","æ‚¨å®¹æ˜“æ„Ÿå†’å—ï¼Ÿ","æ‚¨é¢è‰²èé»„æˆ–æ·¡ç™½å—ï¼Ÿ"] },
        'B': { name: 'é˜³è™šè´¨', desc: 'é˜³æ°”ä¸è¶³ï¼Œä»¥ç•å¯’æ€•å†·ï¼Œå››è‚¢ä¸æ¸©ç­‰è™šå¯’è¡¨ç°ä¸ºä¸»è¦ç‰¹å¾', icon: 'fas fa-snowflake', questions: ["æ‚¨æ‰‹è„šå‘å‡‰å—ï¼Ÿï¼ˆä¸å½“å¿ƒä¼šæ›´å‡‰ï¼‰","æ‚¨èƒƒè„˜éƒ¨ã€èƒŒéƒ¨æˆ–è…°è†éƒ¨æ€•å†·å—ï¼Ÿ","æ‚¨æ¯”ä¸€èˆ¬äººè€å—ä¸äº†å¯’å†·ï¼ˆå¦‚å†¬å­£æ€•å†·ï¼Œå¤å­£å¼€ç©ºè°ƒæ€•é£ï¼‰å—ï¼Ÿ","æ‚¨æ¯”åˆ«äººå®¹æ˜“æ‚£æ„Ÿå†’å—ï¼Ÿ","æ‚¨åƒæˆ–å–å‡‰ä¸œè¥¿ä¼šæ„Ÿåˆ°ä¸èˆ’æœå—ï¼Ÿ","æ‚¨å£å”‡çš„é¢œè‰²åç™½æˆ–åæ·¡å—ï¼Ÿ","æ‚¨å°ä¾¿æ¸…é•¿ï¼ˆå°¿é‡å¤šï¼Œé¢œè‰²æ¸…ï¼‰å—ï¼Ÿ"] },
        'C': { name: 'é˜´è™šè´¨', desc: 'é˜´æ¶²äºå°‘ï¼Œä»¥æ‰‹è¶³å¿ƒçƒ­ã€å£å¹²ã€ç›—æ±—ç­‰è™šçƒ­è¡¨ç°ä¸ºä¸»è¦ç‰¹å¾', icon: 'fas fa-fire', questions: ["æ‚¨æ„Ÿåˆ°æ‰‹è„šå¿ƒå‘çƒ­å—ï¼Ÿ","æ‚¨æ„Ÿåˆ°èº«ä½“ã€è„¸ä¸Šå‘çƒ­å—ï¼Ÿ","æ‚¨çš®è‚¤æˆ–å£å”‡å¹²ç‡¥å—ï¼Ÿ","æ‚¨å£å”‡çš„é¢œè‰²æ¯”ä¸€èˆ¬äººçº¢å—ï¼Ÿ","æ‚¨å®¹æ˜“ä¾¿ç§˜æˆ–å¤§ä¾¿å¹²ç‡¥å—ï¼Ÿ","æ‚¨é¢éƒ¨ä¸¤é¢§æ½®çº¢æˆ–åçº¢å—ï¼Ÿ","æ‚¨æ„Ÿåˆ°çœ¼ç›å¹²æ¶©å—ï¼Ÿ","æ‚¨å¤œé—´ç¡è§‰æ—¶å‡ºæ±—å—ï¼Ÿï¼ˆé†’åæ±—æ­¢ï¼‰"] },
        'D': { name: 'ç—°æ¹¿è´¨', desc: 'ç—°æ¹¿å‡èšï¼Œä»¥ä½“å½¢è‚¥èƒ–ã€è…¹éƒ¨è‚¥æ»¡ã€å¤šç—°ã€èˆŒè‹”åšè…»ç­‰ç—°æ¹¿è¡¨ç°ä¸ºä¸»è¦ç‰¹å¾', icon: 'fas fa-cloud', questions: ["æ‚¨æ„Ÿåˆ°èƒ¸é—·æˆ–è…¹éƒ¨èƒ€æ»¡å—ï¼Ÿ","æ‚¨æ„Ÿåˆ°èº«ä½“ä¸è½»æ¾æˆ–ä¸çˆ½å¿«å—ï¼Ÿ","æ‚¨è…¹éƒ¨è‚¥æ»¡æ¾è½¯å—ï¼Ÿ","æ‚¨é¢éƒ¨æˆ–é¼»éƒ¨æœ‰æ²¹è…»æ„Ÿæˆ–è€…æ²¹äº®å‘å…‰å—ï¼Ÿ","æ‚¨æ±—å¤šï¼Œè€Œä¸”é»è…»å—ï¼Ÿ","æ‚¨è‚¢ä½“å®¹æ˜“å‡ºç°æµ®è‚¿å—ï¼Ÿ","æ‚¨çœ¼æ³¡æµ®è‚¿å—ï¼Ÿ","æ‚¨å—“å­æˆ–å–‰å’™é‡Œæœ‰ç—°å—ï¼Ÿ"] },
        'E': { name: 'æ¹¿çƒ­è´¨', desc: 'æ¹¿çƒ­å†…è•´ï¼Œä»¥é¢å¢æ²¹å…‰ã€æ˜“ç”Ÿç—¤ç–®ã€å£è‹¦ã€å°ä¾¿é»„èµ¤ç­‰æ¹¿çƒ­è¡¨ç°ä¸ºä¸»è¦ç‰¹å¾', icon: 'fas fa-tint', questions: ["æ‚¨é¢éƒ¨æˆ–é¼»éƒ¨æœ‰æ²¹è…»æ„Ÿæˆ–è€…æ²¹äº®å‘å…‰å—ï¼Ÿ","æ‚¨å®¹æ˜“ç”Ÿç—¤ç–®æˆ–ç–®ç––å—ï¼Ÿ","æ‚¨æ„Ÿåˆ°å£è‹¦æˆ–å˜´é‡Œæœ‰å¼‚å‘³å—ï¼Ÿ","æ‚¨å¤§ä¾¿é»æ»ä¸çˆ½ã€æœ‰è§£ä¸å°½çš„æ„Ÿè§‰å—ï¼Ÿ","æ‚¨å°ä¾¿æ—¶å°¿é“æœ‰å‘çƒ­æ„Ÿã€å°¿è‰²æµ“ï¼ˆæ·±ï¼‰å—ï¼Ÿ"], genderQuestions: { male: ["æ‚¨çš„é˜´å›Šéƒ¨ä½æ½®æ¹¿å—ï¼Ÿ"], female: ["æ‚¨å¸¦ä¸‹è‰²é»„ï¼ˆç™½å¸¦é¢œè‰²å‘é»„ï¼‰å—ï¼Ÿ"] } },
        'F': { name: 'æ°”éƒè´¨', desc: 'æ°”æœºéƒæ»ï¼Œä»¥æƒ…å¿—æŠ‘éƒã€èƒ¸èƒèƒ€ç—›ã€çˆ±å¹æ°”ç­‰æ°”éƒè¡¨ç°ä¸ºä¸»è¦ç‰¹å¾', icon: 'fas fa-cloud-meatball', questions: ["æ‚¨æ„Ÿåˆ°é—·é—·ä¸ä¹ã€æƒ…ç»ªä½æ²‰å—ï¼Ÿ","æ‚¨å®¹æ˜“ç´§å¼ ã€ç„¦è™‘ä¸å®‰å—ï¼Ÿ","æ‚¨å¤šæ„å–„æ„Ÿã€æ„Ÿæƒ…è„†å¼±å—ï¼Ÿ","æ‚¨å®¹æ˜“æ„Ÿåˆ°å®³æ€•æˆ–å—æƒŠå“å—ï¼Ÿ","æ‚¨è‚‹éƒ¨ã€èƒƒè„˜éƒ¨æˆ–ä¹³æˆ¿èƒ€ç—›å—ï¼Ÿ","æ‚¨æ— æ•…å”‰å£°å¹æ°”å—ï¼Ÿ","æ‚¨å’½å–‰éƒ¨æœ‰å¼‚ç‰©æ„Ÿï¼Œä¸”åä¹‹ä¸å‡ºã€å’½ä¹‹ä¸ä¸‹å—ï¼Ÿ"] },
        'G': { name: 'è¡€ç˜€è´¨', desc: 'è¡€è¡Œä¸ç•…ï¼Œä»¥é¢è‰²æ™¦æš—ã€å£å”‡é’ç´«ã€çš®è‚¤å®¹æ˜“ç˜€é’ç­‰è¡€ç˜€è¡¨ç°ä¸ºä¸»è¦ç‰¹å¾', icon: 'fas fa-tint-slash', questions: ["æ‚¨çš„çš®è‚¤åœ¨ä¸çŸ¥ä¸è§‰ä¸­ä¼šå‡ºç°é’ç´«è‰²çš„ç˜€æ–‘å—ï¼Ÿ","æ‚¨é¢éƒ¨æˆ–å£å”‡é¢œè‰²æ™¦æš—ï¼ˆé»‘ã€é’ç´«ï¼‰å—ï¼Ÿ","æ‚¨çš®è‚¤å®¹æ˜“å‡ºç°ç˜€ç‚¹ã€ç˜€æ–‘å—ï¼Ÿ","æ‚¨çœ¼ç›ç»å¸¸æœ‰çº¢ä¸å—ï¼Ÿ","æ‚¨å®¹æ˜“å‡ºç°ç–¼ç—›å—ï¼Ÿ","æ‚¨æ„Ÿåˆ°èº«ä½“æˆ–é¢éƒ¨çš®è‚¤ç²—ç³™å—ï¼Ÿ","æ‚¨çš„èˆŒä¸‹é™è„‰ç˜€ç´«æˆ–å¢ç²—å—ï¼Ÿ"] },
        'H': { name: 'ç‰¹ç¦€è´¨', desc: 'å…ˆå¤©å¤±å¸¸ï¼Œä»¥è¿‡æ•ä½“è´¨ã€é—ä¼ å€¾å‘ç­‰ä¸ºä¸»è¦ç‰¹å¾', icon: 'fas fa-allergies', questions: ["æ‚¨æ²¡æœ‰åŸå› åœ°é¼»å¡ã€æµé¼»æ¶•ã€æ‰“å–·åšå—ï¼Ÿ","æ‚¨æ²¡æœ‰åŸå› åœ°çš®è‚¤å®¹æ˜“è¿‡æ•ï¼ˆçº¢ã€ç—’ï¼‰å—ï¼Ÿ","æ‚¨æ²¡æœ‰åŸå› åœ°èµ·è¨éº»ç–¹å—ï¼Ÿ","æ‚¨çš®è‚¤å› è¿‡æ•å‡ºç°çº¢ç–¹ã€ç˜™ç—’å—ï¼Ÿ","æ‚¨çš„çš®è‚¤ä¸€æŠ“å°±çº¢ï¼Œå¹¶å‡ºç°æŠ“ç—•å—ï¼Ÿ","æ‚¨æœ‰è¿‡æ•æ€§é¼»ç‚å—ï¼Ÿ","æ‚¨æœ‰è¿‡æ•æ€§å“®å–˜å—ï¼Ÿ"] },
        'I': { name: 'å¹³å’Œè´¨', desc: 'é˜´é˜³æ°”è¡€è°ƒå’Œï¼Œä»¥ç²¾åŠ›å……æ²›ã€ç¡çœ è‰¯å¥½ã€é€‚åº”åŠ›å¼ºç­‰ä¸ºä¸»è¦ç‰¹å¾', icon: 'fas fa-smile', questions: ["æ‚¨ç²¾åŠ›å……æ²›å—ï¼Ÿ","æ‚¨å®¹æ˜“ç–²ä¹å—ï¼Ÿ","æ‚¨è¯´è¯å£°éŸ³æ´ªäº®å—ï¼Ÿ","æ‚¨æ˜“æ‚£æ„Ÿå†’å—ï¼Ÿ","æ‚¨é¢è‰²çº¢æ¶¦æœ‰å…‰æ³½å—ï¼Ÿ","æ‚¨èƒƒå£å¥½å—ï¼Ÿ","æ‚¨ç¡çœ å¾ˆå¥½å—ï¼Ÿ","æ‚¨é€‚åº”è‡ªç„¶ç¯å¢ƒèƒ½åŠ›å¼ºå—ï¼Ÿï¼ˆå¦‚ä¸è€å—å¯’çƒ­ï¼‰"], reverse: [2, 4] }
      };
      
      let currentSection = 0; 
      const typeKeys = Object.keys(constitutionTypes); 
      let userGender = 'male'; 
      const introSection = document.getElementById('intro-section'); 
      const testForm = document.getElementById('constitution-test'); 
      const prevBtn = document.getElementById('prev-btn'); 
      const nextBtn = document.getElementById('next-btn'); 
      const submitBtn = document.getElementById('submit-btn'); 
      const startBtn = document.getElementById('start-btn'); 
      const progress = document.getElementById('progress'); 
      const progressText = document.getElementById('progress-text'); 
      const sectionIndicator = document.getElementById('section-indicator'); 
      const resultSection = document.getElementById('result-section'); 
      const resultContent = document.getElementById('result-content'); 
      const restartBtn = document.getElementById('restart-btn');

      function initTestForm(){ 
        testForm.innerHTML=''; 
        typeKeys.forEach((key)=>{ 
          const type=constitutionTypes[key]; 
          const section=document.createElement('div'); 
          section.className='question-section'; 
          section.id=`section-${key}`; 
          const group=document.createElement('div'); 
          group.className='question-group'; 
          const title=document.createElement('h3'); 
          title.innerHTML=`<i class="${type.icon}"></i> ${type.name} (${key}ç»„)`; 
          group.appendChild(title); 
          type.questions.forEach((q,idx)=>addQuestion(group,key,idx+1,q,false)); 
          if(type.genderQuestions && type.genderQuestions[userGender]){ 
            type.genderQuestions[userGender].forEach((q,idx)=>addQuestion(group,key,type.questions.length+idx+1,q,true)); 
          } 
          section.appendChild(group); 
          testForm.appendChild(section); 
        }); 
        showSection(0); 
      }

      function addQuestion(group,key,qIndex,question,isGenderSpecific){ 
        const d=document.createElement('div'); 
        d.className='question'; 
        if(isGenderSpecific) d.classList.add('gender-specific'); 
        const t=document.createElement('p'); 
        t.textContent=`${qIndex}. ${question}`; 
        d.appendChild(t); 
        const opts=document.createElement('div'); 
        opts.className='options'; 
        for(let i=1;i<=5;i++){ 
          const w=document.createElement('div'); 
          w.className='option'; 
          const input=document.createElement('input'); 
          input.type='radio'; 
          input.name=`${key}-${qIndex}`; 
          input.id=`${key}-${qIndex}-${i}`; 
          input.value=i; 
          const label=document.createElement('label'); 
          label.htmlFor=`${key}-${qIndex}-${i}`; 
          label.textContent=i===1?'1åˆ†(æ²¡æœ‰)':i===2?'2åˆ†(å¾ˆå°‘)':i===3?'3åˆ†(æœ‰æ—¶)':i===4?'4åˆ†(ç»å¸¸)':'5åˆ†(æ€»æ˜¯)'; 
          w.appendChild(input); 
          w.appendChild(label); 
          opts.appendChild(w);
        } 
        d.appendChild(opts); 
        group.appendChild(d); 
      }

      function showSection(index){ 
        document.querySelectorAll('.question-section').forEach(s=>s.classList.remove('active')); 
        document.getElementById(`section-${typeKeys[index]}`).classList.add('active'); 
        const pct=((index+1)/(typeKeys.length+1))*100; 
        progress.style.width=`${pct}%`; 
        progressText.textContent=`è¿›åº¦: ${Math.round(pct)}%`; 
        sectionIndicator.textContent=`${index+1}/${typeKeys.length}`; 
        prevBtn.style.display=index===0?'none':'block'; 
        nextBtn.style.display=index===typeKeys.length-1?'none':'block'; 
        submitBtn.style.display=index===typeKeys.length-1?'block':'none'; 
      }

      function calculateRawScore(type,answers){ 
        let raw=0; 
        const qc=constitutionTypes[type].questions.length; 
        const rev=constitutionTypes[type].reverse||[]; 
        for(let i=1;i<=qc;i++){ 
          const ans=answers[`${type}-${i}`]; 
          if(!ans) return null; 
          let sc=parseInt(ans); 
          if(rev.includes(i)){ sc=6-sc; } 
          raw+=sc; 
        } 
        if(constitutionTypes[type].genderQuestions && constitutionTypes[type].genderQuestions[userGender]){ 
          const gq=constitutionTypes[type].genderQuestions[userGender]; 
          gq.forEach((_,idx)=>{ 
            const num=qc+idx+1; 
            const ans=answers[`${type}-${num}`]; 
            if(!ans) return null; 
            raw+=parseInt(ans); 
          }); 
        } 
        return raw; 
      }

      function calculateConversionScore(raw, qc){ 
        return Math.round(((raw - qc) / (qc * 4)) * 100); 
      }

      function collectAnswers(){ 
        const answers={}; 
        let all=true; 
        typeKeys.forEach(key=>{ 
          let qc=constitutionTypes[key].questions.length; 
          if(key==='E' && constitutionTypes[key].genderQuestions){ 
            qc+=constitutionTypes[key].genderQuestions[userGender].length; 
          } 
          for(let i=1;i<=qc;i++){ 
            const name=`${key}-${i}`; 
            const sel=document.querySelector(`input[name="${name}"]:checked`); 
            if(sel){ 
              answers[name]=sel.value; 
            } else { 
              all=false; 
              const el=document.querySelector(`input[name="${name}"]`).closest('.question'); 
              el.style.border='2px solid var(--danger)'; 
              el.style.borderRadius='8px'; 
              el.style.padding='10px'; 
            } 
          } 
        }); 
        return all?answers:null; 
      }

      function determineConstitution(scores){ 
        const res={}; 
        // Ping He (I) Logic
        if(scores['I']>=60){ 
          const others=typeKeys.filter(k=>k!=='I').map(k=>scores[k]); 
          if(others.every(s=>s<30)) res['I']='æ˜¯'; 
          else if(others.every(s=>s<40)) res['I']='åŸºæœ¬æ˜¯'; 
          else res['I']='å¦'; 
        } else res['I']='å¦'; 
        
        // Other types logic
        typeKeys.forEach(k=>{ 
          if(k==='I') return; 
          if(scores[k]>=40) res[k]='æ˜¯'; 
          else if(scores[k]>=30) res[k]='å€¾å‘æ˜¯'; 
          else res[k]='å¦'; 
        }); 
        return res; 
      }

      function getConstitutionDescription(type, result){ 
        const desc={ 
          'I':{ 'æ˜¯':'æ‚¨çš„ä½“è´¨ä¸ºå¹³å’Œè´¨ï¼Œå±äºå¥åº·ä½“è´¨ã€‚é˜´é˜³æ°”è¡€è°ƒå’Œï¼Œä½“æ€é€‚ä¸­ï¼Œé¢è‰²çº¢æ¶¦ï¼Œç²¾åŠ›å……æ²›ã€‚','åŸºæœ¬æ˜¯':'æ‚¨çš„ä½“è´¨åŸºæœ¬æ˜¯å¹³å’Œè´¨ï¼Œæ¥è¿‘å¥åº·ä½“è´¨ã€‚ç»§ç»­ä¿æŒè‰¯å¥½çš„ç”Ÿæ´»ä¹ æƒ¯ï¼Œæ³¨æ„é¿å…åé¢‡ä½“è´¨çš„å€¾å‘ã€‚','å¦':'æ‚¨çš„ä½“è´¨ä¸å±äºå¹³å’Œè´¨ï¼Œå­˜åœ¨ä¸€å®šçš„åé¢‡ã€‚'}, 
          'A':{ 'æ˜¯':'æ‚¨å±äºæ°”è™šè´¨ï¼Œå…ƒæ°”ä¸è¶³ï¼Œå®¹æ˜“ç–²ä¹ã€æ°”çŸ­ã€è‡ªæ±—ã€‚','å€¾å‘æ˜¯':'æ‚¨æœ‰æ°”è™šè´¨å€¾å‘ï¼Œå…ƒæ°”ç¨æœ‰ä¸è¶³ã€‚','å¦':'æ‚¨æ²¡æœ‰æ˜æ˜¾çš„æ°”è™šè´¨ç‰¹å¾ã€‚'}, 
          'B':{ 'æ˜¯':'æ‚¨å±äºé˜³è™šè´¨ï¼Œé˜³æ°”ä¸è¶³ï¼Œç•å¯’æ€•å†·ã€æ‰‹è¶³ä¸æ¸©ã€‚','å€¾å‘æ˜¯':'æ‚¨æœ‰é˜³è™šè´¨å€¾å‘ï¼Œé˜³æ°”ç¨æœ‰ä¸è¶³ã€‚','å¦':'æ‚¨æ²¡æœ‰æ˜æ˜¾çš„é˜³è™šè´¨ç‰¹å¾ã€‚'}, 
          'C':{ 'æ˜¯':'æ‚¨å±äºé˜´è™šè´¨ï¼Œé˜´æ¶²äºå°‘ï¼Œå®¹æ˜“å£ç‡¥å’½å¹²ã€æ‰‹è¶³å¿ƒçƒ­ã€‚','å€¾å‘æ˜¯':'æ‚¨æœ‰é˜´è™šè´¨å€¾å‘ï¼Œé˜´æ¶²ç¨æœ‰ä¸è¶³ã€‚','å¦':'æ‚¨æ²¡æœ‰æ˜æ˜¾çš„é˜´è™šè´¨ç‰¹å¾ã€‚'}, 
          'D':{ 'æ˜¯':'æ‚¨å±äºç—°æ¹¿è´¨ï¼Œç—°æ¹¿å‡èšï¼Œå®¹æ˜“å½¢ä½“è‚¥èƒ–ã€è…¹éƒ¨è‚¥æ»¡ã€å£é»è‹”è…»ã€‚','å€¾å‘æ˜¯':'æ‚¨æœ‰ç—°æ¹¿è´¨å€¾å‘ï¼Œä½“å†…ç—°æ¹¿ç¨æœ‰ç§¯èšã€‚','å¦':'æ‚¨æ²¡æœ‰æ˜æ˜¾çš„ç—°æ¹¿è´¨ç‰¹å¾ã€‚'}, 
          'E':{ 'æ˜¯':'æ‚¨å±äºæ¹¿çƒ­è´¨ï¼Œæ¹¿çƒ­å†…è•´ï¼Œé¢å¢æ²¹å…‰ã€å£è‹¦ã€è‹”é»„è…»ã€‚','å€¾å‘æ˜¯':'æ‚¨æœ‰æ¹¿çƒ­è´¨å€¾å‘ï¼Œä½“å†…æ¹¿çƒ­ç¨æœ‰ç§¯èšã€‚','å¦':'æ‚¨æ²¡æœ‰æ˜æ˜¾çš„æ¹¿çƒ­è´¨ç‰¹å¾ã€‚'}, 
          'G':{ 'æ˜¯':'æ‚¨å±äºè¡€ç˜€è´¨ï¼Œè¡€è¡Œä¸ç•…ï¼Œè‚¤è‰²æ™¦æš—ã€èˆŒè´¨ç´«é»¯ã€‚','å€¾å‘æ˜¯':'æ‚¨æœ‰è¡€ç˜€è´¨å€¾å‘ï¼Œè¡€æ¶²å¾ªç¯ç¨æœ‰ä¸ç•…ã€‚','å¦':'æ‚¨æ²¡æœ‰æ˜æ˜¾çš„è¡€ç˜€è´¨ç‰¹å¾ã€‚'}, 
          'F':{ 'æ˜¯':'æ‚¨å±äºæ°”éƒè´¨ï¼Œæ°”æœºéƒæ»ï¼Œç¥æƒ…æŠ‘éƒã€å¿§è™‘è„†å¼±ã€‚','å€¾å‘æ˜¯':'æ‚¨æœ‰æ°”éƒè´¨å€¾å‘ï¼Œæ°”æœºç¨æœ‰éƒæ»ã€‚','å¦':'æ‚¨æ²¡æœ‰æ˜æ˜¾çš„æ°”éƒè´¨ç‰¹å¾ã€‚'}, 
          'H':{ 'æ˜¯':'æ‚¨å±äºç‰¹ç¦€è´¨ï¼Œå…ˆå¤©å¤±å¸¸ï¼Œå®¹æ˜“è¿‡æ•ã€‚','å€¾å‘æ˜¯':'æ‚¨æœ‰ç‰¹ç¦€è´¨å€¾å‘ï¼Œç¨æœ‰è¿‡æ•ååº”ã€‚','å¦':'æ‚¨æ²¡æœ‰æ˜æ˜¾çš„ç‰¹ç¦€è´¨ç‰¹å¾ã€‚'} 
        }; 
        return desc[type]?desc[type][result]:'æš‚æ— å…·ä½“æè¿°ã€‚'; 
      }

      function getHealthAdvice(type){ 
        const adv={ 
          'I':["ä¿æŒå‡è¡¡é¥®é£Ÿï¼Œä¸åé£Ÿä¸æŒ‘é£Ÿ","é€‚åº¦è¿åŠ¨ï¼Œä¿æŒèº«ä½“æ´»åŠ›","è§„å¾‹ä½œæ¯ï¼Œä¿è¯å……è¶³ç¡çœ ","ä¿æŒå¿ƒæƒ…æ„‰æ‚¦ï¼Œé¿å…è¿‡åº¦æƒ…ç»ªæ³¢åŠ¨"], 
          'A':["é€‚å½“è¿›è¡Œæ¸©å’Œè¿åŠ¨ï¼Œå¦‚å¤ªæã€æ•£æ­¥","é¥®é£Ÿä¸Šå¯å¤šé£Ÿç”¨è¡¥æ°”é£Ÿç‰©å¦‚å±±è¯ã€å¤§æ£ã€é»„èŠª","é¿å…è¿‡åº¦åŠ³ç´¯ï¼Œæ³¨æ„åŠ³é€¸ç»“åˆ","ä¿æŒå……è¶³ç¡çœ ï¼Œé¿å…ç†¬å¤œ"], 
          'B':["å¤šè¿›è¡Œæ¸©å’Œè¿åŠ¨ï¼Œæ³¨æ„ä¿æš–","é¥®é£Ÿä¸Šå¯å¤šé£Ÿç”¨æ¸©çƒ­é£Ÿç‰©å¦‚ç”Ÿå§œã€ç¾Šè‚‰ã€æ¡‚åœ†","é¿å…ç”Ÿå†·é£Ÿç‰©å’Œé¥®æ–™","é€‚å½“æ™’å¤ªé˜³ï¼Œå°¤å…¶æ˜¯èƒŒéƒ¨"], 
          'C':["é¿å…è¾›è¾£ç‡¥çƒ­é£Ÿç‰©","å¤šé£Ÿç”¨æ»‹é˜´é£Ÿç‰©å¦‚é“¶è€³ã€ç™¾åˆã€æ¸æ","ä¿æŒå……è¶³ç¡çœ ï¼Œé¿å…ç†¬å¤œ","é€‚å½“è¿›è¡Œç¼“å’Œè¿åŠ¨ï¼Œé¿å…å¤§æ±—æ·‹æ¼“"], 
          'D':["æ§åˆ¶é¥®é£Ÿï¼Œå‡å°‘ç”œè…»æ²¹è…»é£Ÿç‰©","é€‚å½“è¿åŠ¨ï¼Œä¿ƒè¿›æ–°é™ˆä»£è°¢","é¥®é£Ÿæ¸…æ·¡ï¼Œå¤šåƒè”¬èœæ°´æœ","é¿å…ä¹…åï¼Œå¤šæ´»åŠ¨èº«ä½“"], 
          'E':["é¥®é£Ÿæ¸…æ·¡ï¼Œé¿å…æ²¹è…»è¾›è¾£","å¤šé£Ÿç”¨æ¸…çƒ­åˆ©æ¹¿é£Ÿç‰©å¦‚ç»¿è±†ã€å†¬ç“œã€è–ç±³","ä¿æŒè§„å¾‹ä½œæ¯ï¼Œé¿å…ç†¬å¤œ","é€‚å½“è¿åŠ¨ï¼Œä¿ƒè¿›æ’æ±—æ’æ¹¿"], 
          'G':["é€‚å½“è¿›è¡Œæœ‰æ°§è¿åŠ¨ï¼Œä¿ƒè¿›è¡€æ¶²å¾ªç¯","å¯é£Ÿç”¨æ´»è¡€åŒ–ç˜€é£Ÿç‰©å¦‚å±±æ¥‚ã€é»‘æœ¨è€³ã€çº¢ç³–","ä¿æŒé€‚åº¦è¿åŠ¨ï¼Œé¿å…ä¹…å","ä¿æŒå¿ƒæƒ…èˆ’ç•…ï¼Œé¿å…æƒ…ç»ªæŠ‘éƒ"], 
          'F':["ä¿æŒå¿ƒæƒ…èˆ’ç•…ï¼Œé€‚å½“è¿›è¡Œæ”¾æ¾æ´»åŠ¨å¦‚ç‘œä¼½ã€å†¥æƒ³","å¯é£Ÿç”¨ç†æ°”é£Ÿç‰©å¦‚æŸ‘æ©˜ã€ç«ç‘°èŠ±ã€è–„è·","å¤šä¸äººäº¤æµï¼Œé€‚å½“è¿›è¡Œæˆ·å¤–æ´»åŠ¨","åŸ¹å…»å…´è¶£çˆ±å¥½ï¼Œè½¬ç§»æ³¨æ„åŠ›"], 
          'H':["é¿å…æ¥è§¦è¿‡æ•åŸï¼Œæ³¨æ„ç¯å¢ƒæ¸…æ´","å¯é€‚å½“é£Ÿç”¨å¢å¼ºå…ç–«åŠ›é£Ÿç‰©å¦‚çµèŠã€æ¸æã€å±±è¯","ä¿æŒå®¤å†…é€šé£ï¼Œé¿å…æ½®æ¹¿ç¯å¢ƒ","é€‚å½“é”»ç‚¼ï¼Œå¢å¼ºä½“è´¨"] 
        }; 
        return adv[type]||["ä¿æŒå¥åº·ç”Ÿæ´»æ–¹å¼ï¼Œå‡è¡¡é¥®é£Ÿï¼Œé€‚åº¦è¿åŠ¨"]; 
      }

      function displayResults(results, scores){ 
        resultContent.innerHTML=''; 
        const scoreSection=document.createElement('div'); 
        scoreSection.className='result-score'; 
        typeKeys.forEach(key=>{ 
          const item=document.createElement('div'); 
          item.className='score-item'; 
          if(results[key]==='æ˜¯') item.classList.add('primary'); 
          else if(results[key]==='å€¾å‘æ˜¯') item.classList.add('tendency'); 
          item.innerHTML=`<div class="score-type">${constitutionTypes[key].name}</div><div class="score-value">${scores[key]}åˆ†</div>`; 
          scoreSection.appendChild(item); 
        }); 
        resultContent.appendChild(scoreSection); 
        
        if(results['I']!=='å¦'){ 
          const el=document.createElement('div'); 
          el.className=`constitution-type ${results['I']==='æ˜¯'?'primary':'tendency'}`; 
          const al=getHealthAdvice('I').map(i=>`<li>${i}</li>`).join(''); 
          el.innerHTML=`<h3><i class="${constitutionTypes['I'].icon}"></i> ${constitutionTypes['I'].name}</h3><div class="result-desc">${constitutionTypes['I'].desc}</div><div class="advice"><h4><i class="fas fa-clipboard-check"></i> åˆ¤å®šç»“æœä¸åˆ†æ</h4><p>${getConstitutionDescription('I',results['I'])}</p><h4><i class="fas fa-heart"></i> å…»ç”Ÿå»ºè®®</h4><ul class="advice-list">${al}</ul></div>`; 
          resultContent.appendChild(el); 
        } 
        
        typeKeys.forEach(key=>{ 
          if(key==='I' || results[key]==='å¦') return; 
          const el=document.createElement('div'); 
          el.className=`constitution-type ${results[key]==='æ˜¯'?'primary':'tendency'}`; 
          const al=getHealthAdvice(key).map(i=>`<li>${i}</li>`).join(''); 
          el.innerHTML=`<h3><i class="${constitutionTypes[key].icon}"></i> ${constitutionTypes[key].name}</h3><div class="result-desc">${constitutionTypes[key].desc}</div><div class="advice"><h4><i class="fas fa-clipboard-check"></i> åˆ¤å®šç»“æœä¸åˆ†æ</h4><p>${getConstitutionDescription(key,results[key])}</p><h4><i class="fas fa-heart"></i> å…»ç”Ÿå»ºè®®</h4><ul class="advice-list">${al}</ul></div>`; 
          resultContent.appendChild(el); 
        }); 
        
        if(resultContent.children.length===1){ 
          const el=document.createElement('div'); 
          el.className='constitution-type'; 
          el.innerHTML=`<h3><i class="fas fa-info-circle"></i> æš‚æ— æ˜æ˜¾åé¢‡ä½“è´¨</h3><p>æ‚¨çš„ä½“è´¨æ¯”è¾ƒå¹³è¡¡ï¼Œæœªæ˜¾ç¤ºå‡ºæ˜æ˜¾çš„åé¢‡å€¾å‘ã€‚å»ºè®®ç»§ç»­ä¿æŒå¥åº·çš„ç”Ÿæ´»æ–¹å¼ã€‚</p>`; 
          resultContent.appendChild(el); 
        } 
        
        resultSection.style.display='block'; 
        testForm.style.display='none'; 
        prevBtn.style.display='none'; 
        nextBtn.style.display='none'; 
        submitBtn.style.display='none'; 
        introSection.style.display='none'; 
        progress.style.width='100%'; 
        progressText.textContent='è¿›åº¦: 100%'; 
      }

      startBtn.addEventListener('click', function(){ 
        const genderInput=document.querySelector('input[name="gender"]:checked'); 
        if(genderInput) userGender=genderInput.value; 
        introSection.style.display='none'; 
        testForm.style.display='block'; 
        prevBtn.style.display='none'; 
        nextBtn.style.display='block'; 
        initTestForm(); 
      }); 
      
      prevBtn.addEventListener('click', function(){ 
        if(currentSection>0){ 
          currentSection--; 
          showSection(currentSection); 
        } 
      }); 
      
      nextBtn.addEventListener('click', function(){ 
        const currentType=typeKeys[currentSection]; 
        let qc=constitutionTypes[currentType].questions.length; 
        if(currentType==='E' && constitutionTypes[currentType].genderQuestions){ 
          qc+=constitutionTypes[currentType].genderQuestions[userGender].length; 
        } 
        let all=true; 
        for(let i=1;i<=qc;i++){ 
          if(!document.querySelector(`input[name="${currentType}-${i}"]:checked`)){ 
            all=false; 
            break; 
          } 
        } 
        if(all){ 
          if(currentSection<typeKeys.length-1){ 
            currentSection++; 
            showSection(currentSection);
          } 
        } else { 
          alert('è¯·å›ç­”å½“å‰éƒ¨åˆ†çš„æ‰€æœ‰é—®é¢˜åå†ç»§ç»­'); 
        } 
      }); 
      
      submitBtn.addEventListener('click', function(){ 
        const answers=collectAnswers(); 
        if(answers){ 
          const rawScores={}; 
          const conversionScores={}; 
          typeKeys.forEach(key=>{ 
            let qc=constitutionTypes[key].questions.length; 
            if(key==='E' && constitutionTypes[key].genderQuestions){ 
              qc+=constitutionTypes[key].genderQuestions[userGender].length; 
            } 
            const raw=calculateRawScore(key,answers); 
            if(raw!==null){ 
              rawScores[key]=raw; 
              conversionScores[key]=calculateConversionScore(raw,qc); 
            } 
          }); 
          const results=determineConstitution(conversionScores); 
          displayResults(results, conversionScores); 
        } else { 
          alert('è¯·å›ç­”æ‰€æœ‰é—®é¢˜åå†æäº¤'); 
        } 
      }); 
      
      restartBtn.addEventListener('click', function(){ 
        currentSection=0; 
        resultSection.style.display='none'; 
        introSection.style.display='block'; 
        testForm.style.display='none'; 
        prevBtn.style.display='none'; 
        nextBtn.style.display='none'; 
        submitBtn.style.display='none'; 
        progress.style.width='0%'; 
        progressText.textContent='è¿›åº¦: 0%'; 
        sectionIndicator.textContent='0/9'; 
      });
    </script>
    <script src="main.js"></script>
  </body>
</html>

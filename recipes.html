<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£Ÿè°±ç”Ÿæˆ - AIæº¯æºæ™ºå…»</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="config.js"></script>
    <script src="main.js"></script>
    <style>
        /* Search Section */
        .search-container {
            max-width: 800px;
            margin: 120px auto 40px;
            padding: 0 20px;
            text-align: center;
        }

        .search-box {
            position: relative;
            display: flex;
            align-items: center;
            background: white;
            border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            padding: 8px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .search-box:focus-within {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(107, 144, 128, 0.15);
        }

        .search-input {
            flex: 1;
            border: none;
            outline: none;
            padding: 15px 25px;
            font-size: 1.1rem;
            background: transparent;
            color: var(--text-main);
        }

        .search-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 40px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search-btn:hover {
            background: #557265;
        }

        .search-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* History Chips */
        .history-container {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .history-chip {
            background: rgba(255,255,255,0.8);
            border: 1px solid #eee;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #666;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .history-chip:hover {
            background: var(--highlight-color);
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        /* Result Section */
        .result-section {
            max-width: 800px;
            margin: 40px auto;
            padding: 0 20px;
            display: none; /* Hidden by default */
        }

        .result-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow-medium);
            position: relative;
            overflow: hidden;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .copy-btn {
            background: #f5f5f5;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            color: #666;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: #e0e0e0;
            color: #333;
        }

        .result-content {
            font-size: 1.05rem;
            line-height: 1.8;
            color: #444;
        }
        
        .result-content h3 { color: var(--primary-color); margin-top: 20px; }
        .result-content ul { padding-left: 20px; margin-bottom: 15px; }
        .result-content li { margin-bottom: 8px; }

        /* Loading State */
        .loading-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            border-radius: 20px;
        }

        .cancel-btn {
            margin-top: 15px;
            padding: 8px 20px;
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .cancel-btn:hover { background: #fff0f0; }

        /* Recommend Section Title */
        .recommend-title {
            text-align: center; 
            margin: 60px 0 30px; 
            font-family: var(--font-serif); 
            color: #333;
            position: relative;
        }
        .recommend-title::before, .recommend-title::after {
            content: "";
            display: inline-block;
            width: 50px;
            height: 1px;
            background: #ddd;
            vertical-align: middle;
            margin: 0 15px;
        }

        /* Recipe Modal (Keep for Recommendations) */
        /* ... existing modal styles ... */
    </style>
</head>
<body id="recipes-page">

    <!-- Recipe Modal -->
    <div id="recipeModal" class="recipe-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeRecipeModal()">&times;</span>
            <div id="modalBody">
                <div style="text-align: center; padding: 40px;">
                    <i class="fas fa-spinner fa-spin fa-2x" style="color: var(--primary-color);"></i>
                    <p style="margin-top: 20px; color: #666;">AI æ­£åœ¨ç”Ÿæˆè¯¦ç»†é£Ÿè°±...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ç»Ÿä¸€å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-leaf"></i> æº¯æºæ™ºå…»
            </div>
            <div class="mobile-menu-btn" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </div>
            <div class="nav-links">
                <a href="index.html" class="nav-link">é¦–é¡µ</a>
                <a href="assessment.html" class="nav-link">ä½“è´¨æµ‹è¯„</a>
                <a href="plan.html" class="nav-link">æ»‹è¡¥è®¡åˆ’</a>
                <a href="advisor.html" class="nav-link">AIé¡¾é—®</a>
                <a href="poster.html" class="nav-link">èŠ‚æ°”æµ·æŠ¥</a>
                <a href="recipes.html" class="nav-link active">é£Ÿè°±ç”Ÿæˆ</a>
                <a href="account.html" class="nav-link">ä¸ªäººä¸­å¿ƒ</a>
            </div>
        </div>
    </nav>

    <!-- ç§»åŠ¨ç«¯ä¾§è¾¹æ  -->
    <div class="mobile-overlay" onclick="toggleMobileMenu()"></div>
    <div class="mobile-drawer">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <div class="logo" style="font-size: 1.2rem;"><i class="fas fa-leaf"></i> æº¯æºæ™ºå…»</div>
            <div onclick="toggleMobileMenu()" style="font-size: 1.5rem; color: #666;"><i class="fas fa-times"></i></div>
        </div>
        <a href="index.html" class="nav-link">é¦–é¡µ</a>
        <a href="assessment.html" class="nav-link">ä½“è´¨æµ‹è¯„</a>
        <a href="advisor.html" class="nav-link">AIé¡¾é—®</a>
        <a href="poster.html" class="nav-link">èŠ‚æ°”æµ·æŠ¥</a>
        <a href="recipes.html" class="nav-link active">é£Ÿè°±ç”Ÿæˆ</a>
        <a href="account.html" class="nav-link">ä¸ªäººä¸­å¿ƒ</a>
    </div>

    <div class="container">
        <!-- New Search Section -->
        <div class="search-container">
            <h1 style="font-family: var(--font-serif); font-size: 2.5rem; margin-bottom: 20px; color: var(--primary-color);">AI æ™ºèƒ½é£Ÿè°±å®šåˆ¶</h1>
            <p style="color: var(--text-secondary); margin-bottom: 40px;">è¾“å…¥é£Ÿææˆ–èœåï¼Œè·å–ä¸“ä¸šå…»ç”Ÿçƒ¹é¥ªæŒ‡å—</p>
            
            <div class="search-box">
                <input type="text" id="recipeSearchInput" class="search-input" placeholder="è¯·è¾“å…¥é£Ÿææˆ–èœå (å¦‚ï¼šå±±è¯ã€çº¢è±†è–ç±³)..." maxlength="200">
                <button id="recipeSearchBtn" class="search-btn" onclick="handleSearch()">
                    <i class="fas fa-search"></i> æœç´¢é£Ÿè°±
                </button>
            </div>

            <div class="history-container" id="searchHistory">
                <!-- History chips will be injected here -->
            </div>
        </div>

        <!-- Result Section -->
        <div id="recipeResultSection" class="result-section">
            <div class="result-card">
                <!-- Loading Overlay -->
                <div id="recipeLoading" class="loading-overlay" style="display: none;">
                    <i class="fas fa-spinner fa-spin fa-3x" style="color: var(--primary-color);"></i>
                    <p style="margin-top: 15px; color: #666;">AI æ­£åœ¨ç²¾å¿ƒè®¾è®¡é£Ÿè°±...</p>
                    <button class="cancel-btn" onclick="cancelSearch()">å–æ¶ˆç”Ÿæˆ</button>
                </div>

                <div class="result-header">
                    <h2 id="resultTitle" style="color: var(--primary-color); font-family: var(--font-serif);">é£Ÿè°±è¯¦æƒ…</h2>
                    <button class="copy-btn" onclick="copyResult()">
                        <i class="far fa-copy"></i> å¤åˆ¶ç»“æœ
                    </button>
                </div>
                <div id="resultContent" class="result-content">
                    <!-- Markdown content goes here -->
                </div>
            </div>
        </div>

        <!-- Existing Recommendation Gallery -->
        <div class="recommend-title">æ¯æ—¥ç²¾é€‰æ¨è</div>

        <div class="recipe-grid" id="recipeContainer">
            <!-- Dynamic Generation -->
        </div>
    </div>

    <script>
        const recipes = [
            {
                title: "å±±è¯å°ç±³ç²¥",
                img: "https://images.unsplash.com/photo-1511690656952-34342d2c28f5?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                tags: ["æ˜¥å­£", "æ°”è™šè´¨", "æ—©é¤"],
                desc: "å±±è¯å«æœ‰æ·€ç²‰é…¶ã€å¤šé…šæ°§åŒ–é…¶ç­‰ç‰©è´¨ï¼Œæœ‰åˆ©äºè„¾èƒƒæ¶ˆåŒ–å¸æ”¶åŠŸèƒ½ã€‚å°ç±³å¥è„¾å’Œèƒƒã€‚äºŒè€…æ­é…ï¼Œæ¸©è¡¥è„¾èƒƒï¼Œé€‚åˆæ°”è™šä½“è´¨æ˜¥å­£é£Ÿç”¨ã€‚",
                ingredients: ["é“æ£å±±è¯", "å°ç±³", "çº¢æ£"]
            },
            {
                title: "å½“å½’ç¾Šè‚‰æ±¤",
                img: "https://images.unsplash.com/photo-1603048297172-c92544798d5e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                tags: ["å†¬å­£", "é˜³è™šè´¨", "æ™šé¤"],
                desc: "æ¸©è¡¥æ°”è¡€çš„ç»å…¸åæ–¹ã€‚ç¾Šè‚‰æ€§æ¸©ï¼Œæ¸©ä¸­æš–è‚¾ï¼›å½“å½’è¡¥è¡€æ´»è¡€ã€‚é€‚åˆå†¬å­£æ‰‹è„šå†°å‡‰ã€ç•å¯’æ€•å†·çš„é˜³è™šäººç¾¤ã€‚",
                ingredients: ["ç¾Šè‚‰", "å½“å½’", "ç”Ÿå§œ"]
            },
            {
                title: "ç™¾åˆé“¶è€³ç¾¹",
                img: "https://images.unsplash.com/photo-1546039907-7fa05f864c02?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                tags: ["ç§‹å­£", "é˜´è™šè´¨", "ç”œç‚¹"],
                desc: "æ»‹é˜´æ¶¦è‚ºï¼Œæ¸…å¿ƒå®‰ç¥ã€‚ç™¾åˆå…»é˜´æ¶¦è‚ºï¼Œé“¶è€³ç”Ÿæ´¥ç›Šæ°”ã€‚é€‚åˆç§‹å­£çš®è‚¤å¹²ç‡¥ã€å£å¹²èˆŒç‡¥çš„é˜´è™šä½“è´¨ã€‚",
                ingredients: ["å¹²ç™¾åˆ", "é“¶è€³", "æ¸æ"]
            },
            {
                title: "èµ¤å°è±†è–ç±³æ°´",
                img: "https://images.unsplash.com/photo-1464305795204-6f5bbfc7fb81?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                tags: ["å¤å­£", "æ¹¿çƒ­è´¨", "èŒ¶é¥®"],
                desc: "æ¸…çƒ­åˆ©æ¹¿ï¼Œå¥è„¾ç¥›æ¹¿ã€‚èµ¤å°è±†åˆ©æ°´æ¶ˆè‚¿ï¼Œè–ç±³å¥è„¾æ¸—æ¹¿ã€‚é€‚åˆå¤å­£æ¹¿æ°”é‡ã€é¢éƒ¨æ²¹å…‰çš„æ¹¿çƒ­ä½“è´¨ã€‚",
                ingredients: ["èµ¤å°è±†", "è–ç±³", "èŠ¡å®"]
            }
        ];

        let searchController = null;

        // --- Core Search Functions ---

        async function handleSearch(query = null) {
            // 1. Get Input
            const inputEl = document.getElementById('recipeSearchInput');
            const searchText = query || inputEl.value.trim();
            
            // 2. Validation
            if (!searchText) {
                alert("è¯·è¾“å…¥é£Ÿææˆ–èœå");
                inputEl.focus();
                return;
            }
            if (searchText.length > 200) {
                alert("è¾“å…¥å†…å®¹è¿‡é•¿ï¼Œè¯·æ§åˆ¶åœ¨200å­—ä»¥å†…");
                return;
            }

            // 3. UI State: Loading
            const resultSection = document.getElementById('recipeResultSection');
            const loadingOverlay = document.getElementById('recipeLoading');
            const contentDiv = document.getElementById('resultContent');
            const titleEl = document.getElementById('resultTitle');
            
            resultSection.style.display = 'block';
            loadingOverlay.style.display = 'flex';
            contentDiv.innerHTML = ''; // Clear previous
            titleEl.textContent = `æ­£åœ¨ä¸ºæ‚¨è§£æï¼š${searchText}`;
            inputEl.value = searchText; // Update input if clicked from history

            // 4. Update History
            updateSearchHistory(searchText);

            // 5. Execute API Call with Retry/Cancel
            try {
                // Cancel previous if exists
                if (searchController) {
                    searchController.abort();
                }
                searchController = new AbortController();

                const responseText = await fetchRecipeWithRetry(searchText, searchController.signal);
                
                // 6. Render Result
                renderResult(responseText);

            } catch (error) {
                if (error.name === 'AbortError') {
                    console.log('Search cancelled');
                    // Do not hide loading if user manually cancelled? 
                    // Usually we hide loading or show "Cancelled"
                    contentDiv.innerHTML = '<p style="color: #999; text-align: center;">å·²å–æ¶ˆç”Ÿæˆ</p>';
                } else {
                    console.error('Search Failed:', error);
                    contentDiv.innerHTML = `
                        <div style="text-align: center; color: #e74c3c; padding: 20px;">
                            <i class="fas fa-exclamation-circle fa-2x"></i>
                            <p style="margin-top: 10px;">ç”Ÿæˆå¤±è´¥: ${error.message}</p>
                            <button class="btn-outline" onclick="handleSearch('${searchText}')" style="margin-top: 15px;">é‡è¯•</button>
                        </div>
                    `;
                }
            } finally {
                loadingOverlay.style.display = 'none';
                searchController = null;
            }
        }

        function cancelSearch() {
            if (searchController) {
                searchController.abort();
            }
        }

        async function fetchRecipeWithRetry(query, signal, retries = 3) {
            // Ensure CONFIG is ready
            if (typeof CONFIG === 'undefined' || !CONFIG.RECIPE_BOT_ID) {
                throw new Error("ç³»ç»Ÿé…ç½®ç¼ºå¤±");
            }

            let attempt = 0;
            let lastError;

            while (attempt <= retries) {
                try {
                    // Check signal before start
                    if (signal.aborted) throw new DOMException('Aborted', 'AbortError');

                    // Note: We need to use a fetch wrapper that supports signal and timeout
                    // main.js callCozeAPI doesn't support signal/timeout directly.
                    // We will implement the fetch logic here to strictly follow requirements.
                    
                    const botId = CONFIG.RECIPE_BOT_ID;
                    const timeoutMs = 10000; // 10s timeout

                    // Setup timeout signal
                    const timeoutController = new AbortController();
                    const timeoutId = setTimeout(() => timeoutController.abort(), timeoutMs);
                    
                    // Combine signals (user cancel + timeout)
                    const combinedSignal = anySignal([signal, timeoutController.signal]);

                    // Use Mock or Real API based on CONFIG
                    let responseContent = "";
                    
                    if (CONFIG.USE_MOCK) {
                         // Simulate Mock Delay
                         await new Promise((resolve, reject) => {
                             const timer = setTimeout(resolve, 1500);
                             combinedSignal.addEventListener('abort', () => {
                                 clearTimeout(timer);
                                 reject(new DOMException('Aborted', 'AbortError'));
                             });
                         });
                         // Mock Response
                         responseContent = `
### ğŸ² ${query} - å…»ç”Ÿé£Ÿè°± (AIå®šåˆ¶)

**ğŸŒ± é£Ÿææ¸…å•ï¼š**
* ä¸»æ–™ï¼š${query} é€‚é‡
* è¾…æ–™ï¼šæ¸æ 10g, ç”Ÿå§œ 3ç‰‡, çº¢æ£ 5é¢—

**ğŸ”¥ è¯¦ç»†æ­¥éª¤ï¼š**
1. å°†æ‰€æœ‰é£Ÿææ´—å‡€å¤‡ç”¨ã€‚
2. é”…ä¸­åŠ å…¥æ¸…æ°´1000mlï¼Œå¤§ç«çƒ§å¼€ã€‚
3. æ”¾å…¥ä¸»æ–™å’Œç”Ÿå§œï¼Œè½¬ä¸­å°ç«ç‚–ç…®40åˆ†é’Ÿã€‚
4. åŠ å…¥æ¸æå’Œçº¢æ£ï¼Œç»§ç»­ç‚–ç…®10åˆ†é’Ÿã€‚
5. å‡ºé”…å‰åŠ å°‘è®¸ç›è°ƒå‘³ã€‚

**ğŸ’¡ è¥å…»ä»·å€¼ï¼š**
æ­¤æ–¹å…·æœ‰**å¥è„¾å…»èƒƒã€è¡¥æ°”ç›Šè¡€**çš„åŠŸæ•ˆï¼Œç‰¹åˆ«é€‚åˆå½“å‰å­£èŠ‚é£Ÿç”¨ã€‚
                         `;
                    } else {
                        // Real API Call via Proxy (server.js)
                        // Note: server.js expects 'message' in body for generic chat
                        const response = await fetch('/api/chat', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                bot_id: botId,
                                message: query,
                                stream: false,
                                user_id: 'user_recipe_' + Date.now()
                            }),
                            signal: combinedSignal
                        });

                        clearTimeout(timeoutId);

                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }

                        const data = await response.json();
                        responseContent = data.message || (data.messages ? data.messages.find(m=>m.type==='answer').content : "æ— å†…å®¹");
                    }

                    return responseContent;

                } catch (error) {
                    // If aborted by user, don't retry
                    if (signal.aborted || (error.name === 'AbortError' && !error.message.includes('timeout'))) {
                         throw error;
                    }
                    
                    console.warn(`Attempt ${attempt + 1} failed:`, error);
                    lastError = error;
                    attempt++;
                    
                    // Wait before retry (exponential backoff)
                    if (attempt <= retries) {
                        await new Promise(r => setTimeout(r, 1000 * attempt));
                    }
                }
            }
            
            throw new Error(`è¯·æ±‚è¶…æ—¶æˆ–å¤±è´¥ (${lastError.message})`);
        }

        // Helper for combined signals (since AbortSignal.any is not supported in older browsers, stick to simple approach or polyfill)
        // Simple implementation: listen to both
        function anySignal(signals) {
            const controller = new AbortController();
            for (const sig of signals) {
                if (sig.aborted) {
                    controller.abort();
                    return sig;
                }
                sig.addEventListener('abort', () => controller.abort(), { once: true });
            }
            return controller.signal;
        }

        function renderResult(text) {
            const contentDiv = document.getElementById('resultContent');
            if (typeof marked !== 'undefined') {
                contentDiv.innerHTML = marked.parse(text);
            } else {
                contentDiv.textContent = text;
            }
        }

        function copyResult() {
            const content = document.getElementById('resultContent').innerText;
            navigator.clipboard.writeText(content).then(() => {
                const btn = document.querySelector('.copy-btn');
                const originalHtml = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶';
                setTimeout(() => btn.innerHTML = originalHtml, 2000);
            }).catch(err => alert('å¤åˆ¶å¤±è´¥'));
        }

        // --- History Management ---
        function updateSearchHistory(query) {
            let history = JSON.parse(localStorage.getItem('recipe_history') || '[]');
            // Remove if exists (to move to top)
            history = history.filter(h => h !== query);
            // Add to top
            history.unshift(query);
            // Limit to 5
            if (history.length > 5) history.pop();
            
            localStorage.setItem('recipe_history', JSON.stringify(history));
            renderHistory();
        }

        function renderHistory() {
            const container = document.getElementById('searchHistory');
            const history = JSON.parse(localStorage.getItem('recipe_history') || '[]');
            
            if (history.length === 0) {
                container.innerHTML = '';
                return;
            }

            container.innerHTML = history.map(item => `
                <div class="history-chip" onclick="handleSearch('${item}')">
                    <i class="fas fa-history"></i> ${item}
                </div>
            `).join('');
        }

        // --- Init ---
        // Bind Enter Key
        document.getElementById('recipeSearchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSearch();
        });

        // Load History on Start
        renderHistory();

        // Keep Existing Gallery Logic (Renamed to be secondary)
        async function loadRecipes() {
            // Try to load personalized recommendations based on constitution
            const constitutionData = localStorage.getItem('ai_health_constitution');
            if (constitutionData && window.callCozeAPI && typeof CONFIG !== 'undefined') {
                try {
                    const data = JSON.parse(constitutionData);
                    const type = data.type || "å¹³å’Œè´¨";
                    // Determine season (simple logic)
                    const month = new Date().getMonth() + 1;
                    let season = "æ˜¥å­£";
                    if(month >= 6 && month <= 8) season = "å¤å­£";
                    if(month >= 9 && month <= 11) season = "ç§‹å­£";
                    if(month === 12 || month <= 2) season = "å†¬å­£";

                    const container = document.getElementById('recipeContainer');
                    container.innerHTML = `<div style="text-align:center; padding:40px; color:#666;"><i class="fas fa-spinner fa-spin"></i> æ­£åœ¨æ ¹æ®æ‚¨çš„ã€${type}ã€‘ä½“è´¨ç”Ÿæˆæ¨è...</div>`;

                    const prompt = `è¯·ä¸ºã€${season}ã€‘å­£èŠ‚çš„ã€${type}ã€‘ä½“è´¨æ¨è 3 é“å…»ç”Ÿé£Ÿè°±ã€‚
                    è¯·ä¸¥æ ¼è¿”å› JSON æ•°ç»„æ ¼å¼ï¼Œä¸è¦åŒ…å«Markdownæ ‡è®°ã€‚
                    æ ¼å¼ç¤ºä¾‹ï¼š
                    [
                        {"title": "èœå", "desc": "ç®€çŸ­åŠŸæ•ˆä»‹ç»", "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"], "ingredients": ["ä¸»æ–™1", "ä¸»æ–™2"]}
                    ]`;

                    const response = await callCozeAPI(prompt, CONFIG.RECIPE_BOT_ID);
                    
                    // Parse JSON from response (handle potential markdown wrap)
                    let jsonStr = response.replace(/```json/g, '').replace(/```/g, '').trim();
                    const list = JSON.parse(jsonStr);
                    
                    if (Array.isArray(list) && list.length > 0) {
                        // Add default images
                        const enrichedList = list.map(item => ({
                            ...item,
                            img: "https://images.unsplash.com/photo-1547592180-85f173990554?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" // Placeholder
                        }));
                        renderRecipes(enrichedList);
                        return;
                    }
                } catch (e) {
                    console.warn("Failed to load AI recipes, falling back to static", e);
                }
            }
            
            // Fallback to static
            renderRecipes(recipes); 
        }
        
        // ... (Keep existing static recipes array and renderRecipes function) ...
    </script>
</body>
</html>